/* eslint-disable */
const e=require("../_includes/dester-inject-String.js"),a=require("../_includes/dester-inject-JSON.js"),r=require("../_includes/dester-inject-Math.js"),t=require("../jsx2tokens/index.js"),n=require("../utilites/index.js"),i=require("../styles/index.js"),s=require("../storefy/index.js"),l=require("jsx2tokens");var o=Array,u=r.v.pow;function c(e,a,r){for(var t=a+1;t<e.length;t++)if(r(e[t]))return t;return-1}function _(a){return n.chunkifyArrayBy(a,(function(e,a,r){var n,i=r[0].deep,s=e.deep,o=e.type,u=e.value;if(s===i&&((o===l.TOKEN_TYPES.SPACE||/^[,;]$/.test(u))&&((n=t.prevRealTokenIndex(r,a))<0||"="!==r[n].value)&&((n=t.nextRealTokenIndex(r,a))<0||"="!==r[n].value)))return!0;return!1}),void 0,!0).map((function(e){return n.chunkifyArrayBy(t.trimTokens(e),(function(e,a,r){var t=r[0].deep,n=e.deep,i=e.value;return n===t&&"="===i}),void 0,!0).map((function(e){return t.stringifyTokens(t.trimTokens(e))}))})).filter(e.v)}function v(){for(var e=arguments.length,a=new o(e),r=0;r<e;r++)a[r]=arguments[r];return a.join(", ").replace(/[,\s]+$/,"")}function f(e){return 0!==e.indexOf("r-")&&/^[a-z][a-zA-Z0-9-]*$/.test(e)}function p(e){return"r-fragment"===e}var E="ELEMENT_OR_FRAGMENT";function T(e){return/^r-(if|elif|else-if|else|for|watch|await|then)$/.test(e)}function d(e){return"r-slot"===e}var S="RULE_OR_SLOT",h="r-component";function m(e){return"r-tag"===e}function N(e){return e===h||0!==e.indexOf("r-")&&!f(e)}var k="COMPONENT_OR_TAG",I=65535;var R=u(2,31),x=R-1;function O(e){return function(){return((e=(t=(a=16807)&I)*(n=(r=e)&I)+((a>>>16&I)*n+t*(r>>>16&I)<<16>>>0)|0|0%x)&x)/R;var a,r,t,n}}function g(e,a){for(var r=1,t=(e=((a||"")+e).replace(/\r/g,"")).length;t--;)r*=(9e4-r)/(r+e.charCodeAt(t));return+(""+r).replace(/[-.]/g,"")}exports.compiler=function(e,r){var n=void 0===r?{}:r,o=n.env,u=void 0===o?"client":o,I=n.salt,R=void 0===I?"":I,x=n.useJSX,y=void 0===x||x,b=n.jsxImportName,P=void 0===b?"rease/jsx":b,K=n.envImportName,w=void 0===K?"rease/env":K,Y=n.cssImportName,X=void 0===Y?"rease/css":Y,D=n.tsNocheck,A="";(void 0===D||D)&&(A+="// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\n");var $,j,C,L=!("server"===u),F="^['\"`]"+w,J="^['\"`]"+X,M="^['\"`]"+P,G={},q=l.jsx2tokens(e,{useJSX:y,considerChildlessTags:!1,proxy:function(e,a,r){if(e.type===l.TOKEN_TYPES.IDENTIFIER)G[e.value]=!0;else if(!$&&e.value.match(F)){var n=t.prevRealTokenIndex(r,a);if(n>-1&&"from"===r[n].value)for(var i,s=e.deep,o=a;o-- >0;)if((i=r[o]).deep===s){if("import"===i.value){r.splice(o,a-o+1);break}i.type===l.TOKEN_TYPES.IDENTIFIER&&($=i.value)}}else if(!j&&e.value.match(J)){var u=t.prevRealTokenIndex(r,a);if(u>-1&&"from"===r[u].value)for(var c,_=e.deep,v=a;v-- >0;)if((c=r[v]).deep===_){if("import"===c.value){r.splice(v,a-v+1);break}c.type===l.TOKEN_TYPES.IDENTIFIER&&(j=c.value)}}else if(!C&&e.value.match(M)){var f=t.prevRealTokenIndex(r,a);if(f>-1&&/^(import|type|from)$/.test(r[f].value))for(var p,E=e.deep,T=a+1;T-- >0;)if((p=r[T]).deep===E&&"import"===p.value){C="OK",r.splice(T,a-T+1);break}}}}),U=0;function z(e){for(var a=e;a+ ++U in G;);return{origin:e,alias:a+=U}}var B,H,V,W={_$:z("_$"),_expo:z("_x"),_text:z("_t"),_comment:z("_c"),_html:z("_h"),_tag:z("_X"),_component:z("_C"),_componentX:z("_D"),_element:z("_E"),_elementX:z("_R"),_slot:z("_S"),_fragment:z("_F"),_if:z("_i"),_elif:z("_o"),_else:z("_e"),_watch:z("_w"),_await:z("_a"),_then:z("_n"),_for:z("_f"),_func_call:z("_z"),_use_listen:z("_l"),_css:z("_s")},Q={};function Z(e,a){a?e.value+="\n":ie[0][0]===S?e.value+=";\n":e.value+=ie[0][1]?",\n":"\n",ie.length>1&&ie[0][0]&&(ie[0][1]=!0),e.value="  ".repeat(ie.length)+e.value}function ee(e,a){if(void 0===a&&(a=""),ie[0][0]===k){var r=ie[0][2];if(ie[0][2]=ie[0][3]=e,e.value="["+a+", () => { "+e.value+" }]",r){var t="["+a+", () => { ",n=r.value.indexOf(t);n===2*ie.length&&(e.value=e.value.slice(0,-3),r.value="  ".repeat(ie.length+1)+r.value.slice(n+t.length))}}}function ae(e){ie[0][0]===k&&(ie[0][3]=e,e.value=e.value+" }]")}function re(e){var a=s.storefy(e,W._$.alias,y);return s.isStorefy(a)&&(Q._$=!0),a}function te(){B||(B=O(g(R+e)))}function ne(e){return te(),a.v((e||"")+g("",B()).toString(36).slice(0,8))}var ie=[["",!1]];if($)for(var se,le=function(e,a){if((e=q[a]).value!==$)return oe=a,se=e,"continue";if(a>0&&("]"===q[a-1].value||"."===q[a-1].value))return se=e,oe=a,"continue";if(e.value===$&&(H=t.nextRealTokenIndex(q,a))>-1&&"."===q[H].value&&(H=t.nextRealTokenIndex(q,H))>-1){var r=q[H].value;switch(r){case"$":break;case"isClient":case"isServer":case"is_client":case"is_server":case"IS_CLIENT":case"IS_SERVER":var n=L;for(q.splice(a+1,H-a);(H=a-1)>-1&&"!"===q[H].value;)q.splice(a=H,1),n=!n;if(e.type=l.TOKEN_TYPES.BOOLEAN,e.value=""+(n===/CLIENT/i.test(r)),"false"===e.value&&(H=t.nextRealTokenIndex(q,a))>-1&&")"===q[H].value&&(H=t.nextRealTokenIndex(q,H))>-1&&"{"===q[H].value&&(H=t.prevRealTokenIndex(q,a))>-1&&"("===q[H].value&&(H=t.prevRealTokenIndex(q,H))>-1&&"if"===q[H].value){var i=!1;(V=t.prevRealTokenIndex(q,H))>-1&&"else"===q[V].value&&(i=!0,H=V),e.deep--,V=c(q,a,(function(a){return e.deep===a.deep&&"}"===a.value})),q.splice(a=H,V-H+1),!i&&(H=t.nextRealTokenIndex(q,a))>-1&&"else"===q[H].value&&((V=t.nextRealTokenIndex(q,H))>-1&&"if"===q[V].value?q.splice(H,1):q.splice.apply(q,[H,1].concat(l.jsx2tokens("if (true)"))))}break;case"randomString":case"random_string":case"RANDOM_STRING":q.splice(a+1,H-a),e.type=l.TOKEN_TYPES.STRING,e.value=ne();break;case"randomNumber":case"random_number":case"RANDOM_NUMBER":q.splice(a+1,H-a),e.type=l.TOKEN_TYPES.NUMERIC,e.value=(te(),(""+B()).slice(0,8));break;case"requireIfClient":case"requireIfServer":case"require_if_client":case"require_if_server":case"REQUIRE_IF_CLIENT":case"REQUIRE_IF_SERVER":var s="";if(V=c(q,a,(function(r){return s||r.type!==l.TOKEN_TYPES.STRING||(s=r.value),se=e,oe=a,e.deep===r.deep&&")"===r.value})),!s)throw console.error("ENV "+r+" is incorrectly"),t.stringifyTokens(q.splice(a+1,V-a));var o="default";if((H=t.nextRealTokenIndex(q,V))>-1&&"."===q[H].value&&(H=t.nextRealTokenIndex(q,H))>-1&&(o=q[H].value,V=H),q.splice(a+1,V-a),L===/CLIENT/i.test(r)){var u=z(o).alias;A+="import { "+o+" as "+u+" } from "+s+";\n",e.type=l.TOKEN_TYPES.IDENTIFIER,e.value=u}else e.type=l.TOKEN_TYPES.NULL,e.value="null";break;default:throw"rease/env: "+r+" not support"}}se=e,oe=a},oe=0;oe<q.length;oe++)le(se,oe);for(var ue,ce=function(e,r){if(e=q[r],j&&e.value===j&&(!r||"]"!==q[r-1].value&&"."!==q[r-1].value)&&(H=t.nextRealTokenIndex(q,r))>-1&&"`"===q[H].value[0]){var n=H,o=c(q,r,(function(a){return e.deep===a.deep&&/`$/.test(a.value)})),u=t.stringifyTokens(q.splice(H,1+o-n));Q._css=!0;var I=i.styles(u,ne("c"),W._css.alias,re);return e.type=l.TOKEN_TYPES.MODIFIER,e.value=I,ue=e,"continue"}if($&&e.value===$&&(!r||"]"!==q[r-1].value&&"."!==q[r-1].value)&&(H=t.nextRealTokenIndex(q,r))>-1&&"."===q[H].value&&(H=t.nextRealTokenIndex(q,H))>-1){if("$"===q[H].value){q.splice(r+1,H-r),H=t.nextRealTokenIndex(q,r),V=c(q,r+1,(function(a){return e.deep===a.deep&&")"===a.value})),Q._$=!0;var R=s.storefy(t.stringifyTokens(q.splice(H,V-H+1).slice(1,-1)),W._$.alias);s.isStorefy(R)||(R=W._$.alias+"(["+R+"], (a) => a[0])"),e.type=l.TOKEN_TYPES.MODIFIER,e.value=R}return ue=e,"continue"}switch(e.type){case l.TOKEN_TYPES.JSX_EXPRESSION_END:ie.unshift([,!1]);break;case l.TOKEN_TYPES.JSX_EXPRESSION_START:ie.shift();var x=c(q,r,(function(a){return e.deep===a.deep&&a.type===l.TOKEN_TYPES.JSX_EXPRESSION_END})),O=re(t.stringifyTokens(q.splice(r+1,x-r).slice(0,-1)));O?(e.type=l.TOKEN_TYPES.MODIFIER,Q._expo=!0,e.value=W._expo.alias+"("+O+")",ee(e),Z(e)):q.splice(r,1);break;case l.TOKEN_TYPES.JSX_TEXT:e.type=l.TOKEN_TYPES.MODIFIER;var g=e.value.replace(/^\s*\n\s*|\s*\n\s*$/g,"").replace(/\s+/g," ");g?(Q._text=!0,e.value=W._text.alias+"("+a.v(g).replace(/\\\\u/gi,"\\u")+")",ee(e),Z(e)):q.splice(r,1);break;case l.TOKEN_TYPES.JSX_TAG_CLOSER_START:var y=c(q,r,(function(e){return e.type===l.TOKEN_TYPES.JSX_TAG_CLOSER_END})),b=_(q.splice(r+1,y-r).slice(0,-1));e.type=l.TOKEN_TYPES.MODIFIER;var P=b[0]&&b[0][0]||"r-fragment";if(f(P)||p(P))e.value=")";else if(T(P)||d(P))e.value="})";else{if(!N(P)&&!m(P))throw"Tag "+P+" not support";e.value="])"}ae(e),Z(e),f(P)||p(P)?ie.unshift([E,!1]):T(P)||d(P)?ie.unshift([S,!1]):(N(P)||m(P))&&ie.unshift([k,!1]);break;case l.TOKEN_TYPES.JSX_TAG_OPENER_END_CHILDLESS:case l.TOKEN_TYPES.JSX_TAG_OPENER_END:ie.unshift([,!1]);break;case l.TOKEN_TYPES.JSX_TAG_OPENER_START:ie.shift();for(var K,w,Y=c(q,r,(function(e){return e.type===l.TOKEN_TYPES.JSX_TAG_OPENER_END||e.type===l.TOKEN_TYPES.JSX_TAG_OPENER_END_CHILDLESS})),X=q[Y].type===l.TOKEN_TYPES.JSX_TAG_OPENER_END_CHILDLESS,D=_(q.splice(r+1,Y-r).slice(0,-1)),A=D[0]&&D[0].length<2&&D.shift()[0]||"r-fragment",C="",F=[],J="",M="",G="",U="",z="",B="",te="",se="",le="",oe="",ce=0;ce<D.length;ce++)if(K=D[ce][0])if("{"===K[0])F.push(K.slice(1,-1));else switch("{"===(w=D[ce][1]||"")[0]&&(w=re(w.slice(1,-1))),K){case"r-is":C=w;break;case"r-use":M=w;break;case"r-use-client":G=w;break;case"r-use-server":U=w;break;case"r-tag":z=w;break;case"r-slot":B=w;break;case"r-name":te=w;break;case"r-children":se=w;break;case"r-policy":oe=w;break;default:if(K.startsWith("r-on-"))L&&(K=K.slice(5))&&(Q._use_listen=!0,le+=W._use_listen.alias+"('"+K+"', "+w+"), ");else{if(K.startsWith("r-"))throw"System attribute "+K+" not support";"className"===K&&(K="class"),K=/^[$_a-z][$\w]*$/i.test(ve=K)?ve:a.v(ve),w=w||"true",F.push(K+": "+w)}}L?(le&&(M=M?"["===M[0]?"["+le+M.slice(1,-1)+"]":"["+le+"...("+M+") || []]":"["+le.slice(0,-2)+"]"),G&&(M&&"["!==G[0]&&(G="("+G+") || []"),M=M?"["===M[0]?"["+M.slice(1,-1)+", ..."+G+"]":"[...("+M+") || [], ..."+G+"]":G)):U&&(M&&"["!==U[0]&&(U="("+U+") || []"),M=M?"["===M[0]?"["+M.slice(1,-1)+", ..."+U+"]":"[...("+M+") || [], ..."+U+"]":U),F.length&&(J="{ "+F.join(", ")+" }");var _e="";switch(A){case"r-void":if(s.isStorefyForExpo(C))throw"System tag "+A+" does not accept reactive values";_e=v(C);break;case"r-text":Q._expo=!0,_e=W._expo.alias+"("+v(C)+")";break;case"r-comment":Q._comment=!0,_e=W._comment.alias+"("+v(C)+")";break;case"r-html":Q._html=!0,_e=W._html.alias+"("+v(C,oe)+")";break;case"r-fragment":Q._fragment=!0,M&&(J=J||"{}"),_e=W._fragment.alias+"("+v(J,M)+")(";break;case"r-slot":Q._slot=!0,M&&(J=J||"{}"),J&&(C=C||"void 0"),_e=W._slot.alias+"("+v(te||C,J,M)+")(";break;case"r-tag":Q._tag=!0,te&&(M=M||"void 0"),M&&(J=J||"{}"),J&&(C=C||"void 0"),_e=W._tag.alias+"("+v(C,J,M,te)+")(";break;case"r-if":Q._if=!0,M&&(J=J||"{}"),J&&(C=C||"void 0"),_e=W._if.alias+"("+v(C,J,M)+")(";break;case"r-elif":case"r-elseif":case"r-else-if":Q._elif=!0,M&&(J=J||"{}"),J&&(C=C||"void 0"),_e=W._elif.alias+"("+v(C,J,M)+")(";break;case"r-else":Q._else=!0,M&&(J=J||"{}"),_e=W._else.alias+"("+v(J,M)+")(";break;case"r-for":Q._for=!0,M&&(J=J||"{}"),J&&(C=C||"void 0"),_e=W._for.alias+"("+v(C,J,M)+")(";break;case"r-watch":Q._watch=!0,M&&(J=J||"{}"),J&&(C=C||"void 0"),_e=W._watch.alias+"("+v(C,J,M)+")(";break;case"r-await":Q._await=!0,M&&(J=J||"{}"),J&&(C=C||"void 0"),_e=W._await.alias+"("+v(C,J,M)+")(";break;case"r-then":Q._then=!0,M&&(J=J||"{}"),_e=W._then.alias+"("+v(J,M)+")(";break;default:if(N(A))C||A===h?(Q._componentX=!0,C?(M=M||"void 0",J=J||"{}"):M&&(J=J||"{}"),_e=W._componentX.alias+"("+v(A!==h?A:"null",J,M,C)+")("):(Q._component=!0,M&&(J=J||"{}"),_e=W._component.alias+"("+v(A,J,M)+")(");else{if(A.startsWith("r-"))throw"System tag "+A+" not support";z||C?(Q._elementX=!0,M=M||"void 0",J=J||"{}",_e=W._elementX.alias+"("+v(a.v(A),J,M,z||C)+")("):(Q._element=!0,M&&(J=J||"{}"),_e=W._element.alias+"("+v(a.v(A),J,M)+")(")}}if(f(A)||p(A)){if(X)se&&(Q._func_call=!0,_e+=W._func_call.alias+"("+se+")"),_e+=")";else if(se)throw"System tag "+A+" must be childless"}else if(T(A)||d(A)){if(X)_e+=se?se+")":")";else if(_e+="() => {",se)throw"System tag "+A+" must be childless if contains r-children"}else if(N(A)||m(A)){if(X)_e+=se?"[[,"+se+"]]":"[]",_e+=")";else if(_e+="[",se)throw"Component or r-tag "+A+" must be childless"}else if(!_e)throw"Tag "+A+" not found";e.type=l.TOKEN_TYPES.MODIFIER,e.value=_e,X?ae(e):ie.shift(),function(e,a){if(void 0===a&&(a=""),ie[0][0]===k){var r=ie[0][2],t=ie[0][3];if(ie[0][2]=e,e.value="["+a+", () => { "+e.value,r){var n="["+a+", () => { ",i=r.value.indexOf(n);i===2*ie.length&&(t.value=t.value.replace(/[}\],\s\n]+$/,"")+",\n",r.value="  ".repeat(ie.length+1)+r.value.slice(i+n.length))}}}(e,B),Z(e,!X),e.value=e.value.replace(/\s*,\s*,\s*$/,",\n")}var ve;ue=e},_e=q.length;_e-- >0;)ce(ue,_e);var ve=[];for(var fe in Q)ve.push("  "+W[fe].origin+" as "+W[fe].alias);return ve.length&&(A+="import {\n"+ve.join(",\n")+"\n} from 'rease';\n"),A+=t.stringifyTokens(q)};
