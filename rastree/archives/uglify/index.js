'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var e=require('@wareset-utilites/lang/jsonStringify'),t=require('@wareset-utilites/lang/jsonParse'),r=require('@wareset-utilites/array/findIndexLeft'),l=require('@wareset-utilites/array/forEachRight'),u=require('@wareset-utilites/array/forEachLeft'),a=require('@wareset-utilites/array/includes'),i=require('@wareset-utilites/is/isArray'),s=require('@wareset-utilites/object/keys'),f=require('@wareset-utilites/array/last'),n=require('rastree/core/utils/getDelimeter'),o=require('rastree/core/template/lib/utils'),c=require('rastree/core/utils/replaceQuotes'),d=require('rastree/core/template/lib/trimTokens'),p=require('rastree/core/template/lib/source2Tokens'),T=require('rastree/core/template/lib/stringifyTokens'),N=require('@rease/optimize/data'),E=require('./function'),O=require('./functionprototype'),y=require('./json'),_=require('./math'),K=require('./number'),m=require('./lang'),v=require('./object'),q=require('./objectprototype');function b(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}function j(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if('default'!==r){var l=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,l.get?l:{enumerable:!0,get:function(){return e[r]}})}})),t['default']=e,Object.freeze(t)}var g=b(e),R=b(t),h=b(r),I=b(l),S=b(u),P=b(a),A=b(i),C=b(s),U=b(f),w=b(n),G=b(c),k=b(d),D=b(p),x=b(T),z=j(N),M=j(E),F=j(O),$=j(y),L=j(_),J=j(K),Q=j(m),W=j(v),Y=j(q);const B={};S['default'](C['default'](z),(e=>{B[z[e]]=e}));const H=C['default'](B).sort(((e,t)=>t.length-e.length)),V=(e,t=p.TOKEN_PUCNTUATOR)=>({type:t,value:e}),X=()=>[V(') '),V(' ',p.TOKEN_SPACE),V('+'),V(' ',p.TOKEN_SPACE)],Z=()=>[V(' ',p.TOKEN_SPACE),V('+'),V(' ',p.TOKEN_SPACE),V('(')],ee=e=>(A['default'](e)?S['default'](e,ee):(delete e.loc,delete e.deep,delete e.range),e),te=(e,t)=>{let r=h['default'](e,(e=>') '===e.value),t+1);e[r].value=')';const l=e.slice(t+1,r),u=l.length;let a;k['default'](l),((a=!l[1])||l.length!==u)&&(l[0]||(r+=3),a&&(t--,r++),e.splice(t+1,r-t-1,...l))},re=(e,t,r)=>e+t+r;exports.default=(e,{safeMath:t=!0,safeDefaults:r=!0,uglifyStrings:l=!0}={})=>{const u=w['default'](e,'$'),a=(e=>{const t=o.getTokens(e);let r,l,u,a=t.length;for(;a-- >0;)(r=t[a])&&(ee(r),u=r.value,r.type===p.TOKEN_TEMPLATE?(r.type=p.TOKEN_STRING,'`'===u[0]&&U['default'](u)===u[0]?r.value=G['default'](u):'}'===u[0]&&'{'===U['default'](u)?(t.splice(a,1,...X(),V(G['default']('`'+u.slice(1,-2)+'`'),p.TOKEN_STRING),...Z()),te(t,a+8)):'`'===U['default'](u)?(r.value=G['default']('`'+u.slice(1)),t.splice(a,0,...X())):'`'===u[0]&&(r.value=G['default'](u.slice(0,-2)+'`'),t.splice(a+1,0,...Z()),te(t,a+4))):r.type===p.TOKEN_STRING?r.value=G['default'](u):'.'===r.value&&r.type===p.TOKEN_PUCNTUATOR&&l&&l.type!==p.TOKEN_PUCNTUATOR&&t.splice(a,h['default'](t,(e=>e===l),a+1)-a+1,V('['),V(g['default'](l.value),p.TOKEN_STRING),V(']')),!(r=t[a])||'['!==r.value&&']'!==r.value||('['===r.value&&(r=t[a+1])&&r.type===p.TOKEN_SPACE&&t.splice(a+1,1),(r=t[a-1])&&r.type===p.TOKEN_SPACE&&(!(r=t[a-2])||r.type===p.TOKEN_PUCNTUATOR&&')'!==r.value||t.splice(a++-1,1))),t[a].type!==p.TOKEN_SPACE&&(l=t[a]));return t})(D['default'](e).tokens),i={};let s=[];const f={};t&&(f.Math=['math',C['default'](L)]),r&&(f.JSON=['json',C['default']($)],f.Number=['number',C['default'](J)],f.Object=['object',C['default'](W).filter((e=>!(e in Y)))],f[re('object','prototype',u)]=['objectprototype',C['default'](Y)],f.Function=['function',C['default'](M)],f[re('function','prototype',u)]=['functionprototype',C['default'](F)],s=C['default'](Q));const n=C['default'](f),c={},d={};let T,N,E;S['default'](a,((e,t,r,o)=>{let{type:O,value:y}=e;if(O===p.TOKEN_KEYWORD&&('import'===y&&(T=!0),'export'===y&&(N=!0)),N&&(!E&&O===p.TOKEN_STRING||E&&O===p.TOKEN_PUCNTUATOR)&&(N=!1),!T&&!N)if(O===p.TOKEN_IDENTIFIER){let r,l;P['default'](n,y)&&(r=a[t+1])&&'['===r.value&&(r=a[t+3])&&']'===r.value&&(r=a[t+2])&&r.type===p.TOKEN_STRING&&P['default'](f[y][1],l=R['default'](r.value))?(e.value=re(f[y][0],l,u),c[e.value]=[f[y][0],l],a.splice(t+1,3),o.index--):P['default'](s,y)&&(d[y]=1)}else if(O===p.TOKEN_STRING&&l){let r;if(y=R['default'](y),y in B)e.type=p.TOKEN_IDENTIFIER,e.value=B[y]+u,i[B[y]]=1;else if((r=h['default'](H,(e=>P['default'](y,e))))>-1){const e=H[r];i[B[e]]=1;const l=[];l.unshift(V(')'));const s=B[e]+u;I['default'](y.split(e),((e,t)=>{e&&(l[1]&&l.unshift(V('+')),l.unshift(V(g['default'](e),p.TOKEN_STRING))),t&&(l[1]&&l.unshift(V('+')),l.unshift(V(s,p.TOKEN_IDENTIFIER)))})),l.unshift(V('(')),a.splice(t,1,...l),o.index--}}(T||N)&&('from'===y&&(E=!0),(O===p.TOKEN_STRING||O===p.TOKEN_PUCNTUATOR&&/[^,{}]/.test(y))&&(T=N=E=!1))}));const O=C['default'](i);let y='';O[0]&&(y='import { '+O.map((e=>e+' as '+e+u)).join(', ')+' } from \'@rease/optimize/data\';\n\n');const _=C['default'](d);let K='';_[0]&&(K='import { '+_.join(', ')+' } from \'@rease/optimize/lang\';\n\n');let m=C['default'](c).map((e=>`import { ${c[e][1]} as ${e} } from '@rease/optimize/${c[e][0]}';\n`)).join('');m&&(m+='\n');return K+m+y+x['default'](a)};
